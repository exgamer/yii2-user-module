# Организация входа в систему под любым пользователем для суперадминов

1. Добавить в контроллер экшн для входа

```php
<?php

namespace frontend\controllers;

class SiteController extends BaseController
{
    use ServicesTrait;
    use ProjectServicesTrait;
    use \concepture\yii2static\traits\ServicesTrait;

    /**
     * @var string
     */
    public $defaultAction = 'index';

    public function behaviors()
    {
        return ArrayHelper::merge(
            parent::behaviors(),
            [
                'access' => [
                    'class' => AccessControl::class,
                    'rules' => [
                        [
                            'actions' => ['auth-by-user'],
                            'allow' => true,
                            'roles' => [AccessEnum::SUPERADMIN],
                        ],
                    ],
                ],
            ]
        );
    }

    /**
     * @inheritDoc
     */
    public function actions()
    {
        $actions = parent::actions();
        $actions['auth-by-user'] = [
            'class' => 'concepture\yii2user\actions\GodAuthAction',
        ];

        return $actions;
    }

 }

```

2. Создать класс WebUser для текущего подпроекта и унаследовать его от базового
    Добавить в init условие для переключения названия identitycookie
    
```php
<?php
namespace frontend\components;

use Yii;
use concepture\yii2user\WebUser as Base;

/**
 * Класс описывающий атворизованного юзера
 *
 * Class WebUser
 * @package concepture\yii2user
 * @author Olzhas Kulzhambekov <exgamer@live.ru>
 */
class WebUser extends Base
{
    public function init()
    {
        /**
         * Для входа как другой пользователь
         */
        if (Yii::$app->request->cookies->getValue(static::godIdentityCookieName)) {
            $this->asGod();
        }

        parent::init(); // TODO: Change the autogenerated stub
    }
}


```

3. Добавить в контроллер админки экшн для авторизации

```php
<?php

namespace backend\controllers;

class UserController extends BaseController
{
    /**
     * авторизация под выбранным пользователем
     *
     * @param integer $id
     * @param integer $domain_id
     * @throws NotFoundHttpException
     */
    public function actionAuthByUser($id, $domain_id)
    {
        $model = $this->getModel($id, $domain_id);
        if (! $model){
            throw new NotFoundHttpException();
        }

        $data = Yii::$app->domainService->getDomainsData();
        $currentDomainData = $data[$domain_id];
        $url = $currentDomainData['host_with_scheme'];
        $token = JwtHelper::getJWT(['user_id' => $model->id]);

        $this->redirect($url . "/auth-by-user?token=" . $token);
    }

 }

```

4. Добавить в список юзхеров кнопку для перехода 

```php
<?php
        [
            'class'=>'yii\grid\ActionColumn',
            'template'=>'{auth} {credentials} {roles} {permissions} {domain_permissions} {view} {update} {activate} {deactivate} {delete}',
            'buttons'=>[
                'auth'=> function ($url, $model) {
                    if (! Yii::$app->user->can(\concepture\yii2logic\enum\AccessEnum::SUPERADMIN)) {
                        return '';
                    }
            
                    if (! $model->canAuth()) {
                        return '';
                    }
            
                    return Html::a(
                        '<i class="icon-key"></i>' . Yii::t('yii2admin', 'Вход под пользователем (' . $model->username . ')'),
                        ['/user/user/auth-by-user', 'id' => $model['id']],
                        [
                            'class' => 'dropdown-item',
                            'target' => '_blank',
                            'data-pjax' => '0',
                        ]
                    );
                },

```